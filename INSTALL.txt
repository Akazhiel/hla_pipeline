conda create -n jared python=3.6.1
conda activate jared

mkdir -p ~/shared
cd ~/shared

conda install pandas hla-la gatk4 bwa samtools picard trimmomatic varscan cufflinks picard trim-galore star somatic-sniper bedtools

wget https://github.com/git-lfs/git-lfs/releases/download/v2.10.0/git-lfs-linux-386-v2.10.0.tar.gz
tar -xvf git-lfs-linux-386-v2.10.0.tar.gz
export PATH="~/shared/gitlfs:$PATH"
git-lfs install
git clone https://github.com/RabadanLab/arcasHLA.git
cd arcasHLA/
./arcasHLA reference --update
export ARCASHLA_PATH="~/shared/arcasHLA"
cd ..

wget http://www.well.ox.ac.uk/downloads/PRG_MHC_GRCh38_withIMGT.tar.gz
mkdir -p HLA-PA/graphs
tar -xvf PRG_MHC_GRCh38_withIMGT.tar.gz
mv PRG_MHC_GRCh38_withIMGT HLA-PA/graphs
~/anaconda3/envs/alena/opt/hla-la/bin/HLA-LA --action prepareGraph --PRG_graph_dir HLA-LA/graphs/PRG_MH
mkdir ~/anaconda3/envs/alena/opt/hla-la/graphs
mv ~/shared/HLA-LA/graphs/PRG_MHC_GRCh38_withIMGT ~/anaconda3/envs/alena/opt/hla-la/graphs/

wget https://github.com/Illumina/strelka/releases/download/v2.9.10/strelka-2.9.10.centos6_x86_64.tar.bz2
tar -xjf strelka-2.9.10.centos6_x86_64.tar.bz2
mv strelka-2.9.10.centos6_x86_64 ~/shared/strelka
export STRELKA_PATH=~/shared/strelka

wget http://www.openbioinformatics.org/annovar/download/0wgxR2rIVP/annovar.latest.tar.gz
tar -xvf annovar.latest.tar.gz
mv annovar.latest ~/shared/annovar
cd ~/shared/annovar
./annotate_variation.pl -downdb -buildver hg19 -webfrom annovar knownGene humandb/
./annotate_variation.pl -downdb -buildver hg19 -webfrom annovar ensGene humandb/
./annotate_variation.pl -downdb -buildver hg19 -webfrom annovar snp138NonFlagged humandb/
./annotate_variation.pl -downdb -buildver hg19 -webfrom annovar 1000g2015aug humandb/
./annotate_variation.pl -downdb -buildver hg19 -webfrom annovar cosmic70 humandb/
wget http://hgdownload.cse.ucsc.edu/goldenpath/hg19/database/kgXref.txt.gz humandb/hg19_kgXref.txt.gz
gunzip humandb/hg19_kgXref.txt.gz
export ANNOVAR_PATH=~/shared/annovar

cd ~/shared/
mkdir hg19
cd hg19
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz.tbi
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/1000G_phase1.indels.hg19.sites.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/1000G_phase1.indels.hg19.sites.vcf.gz.tbi
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/dbsnp_138.hg19.vcf.gz.tbi
gsutil cp gs://gatk-best-practices/somatic-b37/af-only-gnomad.raw.sites.vcf .
gsutil cp gs://gatk-best-practices/somatic-b37/af-only-gnomad.raw.sites.vcf.idx
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/ucsc.hg19.fasta.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/ucsc.hg19.dict.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/ucsc.hg19.fasta.fai.gz
wget https://hgdownload.soe.ucsc.edu/goldenPath/hg19/bigZips/genes/hg19.refGene.gtf.gz
bwa index ucsc.hg19.fasta.gz
STAR --runMode genomeGenerate --runThreadN 40 --genomeDir STARIndex/ --genomeFastaFiles ucsc.hg19..fasta --sjdbGTFfile hg19.refGene.gtf --sjdbOverhang 99

cd ~/shared/
mkdir GRCh37
cd GRCh37
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/1000G_phase1.indels.b37.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/1000G_phase1.indels.b37.vcf.idx.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/dbsnp_138.b37.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/dbsnp_138.b37.vcf.idx.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/Mills_and_1000G_gold_standard.indels.b37.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/Mills_and_1000G_gold_standard.indels.b37.vcf.idx.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/Mutect2/af-only-gnomad.raw.sites.b37.vcf.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/Mutect2/af-only-gnomad.raw.sites.b37.vcf.gz.tbi
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/human_g1k_v37_decoy.fasta.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/human_g1k_v37_decoy.dict.gz
wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/b37/human_g1k_v37_decoy.fasta.fai.gz
wget ftp://ftp.ensembl.org/pub/release-75/gtf/homo_sapiens/Homo_sapiens.GRCh37.75.gtf.gz
bwa index human_g1k_v37_decoy.fasta.gz
STAR --runMode genomeGenerate --runThreadN 40 --genomeDir STARIndex/ --genomeFastaFiles human_g1k_v37_decoy.fasta --sjdbGTFfile Homo_sapiens.GRCh37.75.gtf --sjdbOverhang 99

mkdir -p ~/Analysis
cd ~/Analysis
git clone hla_pipeline
cp hla_pipeline/shared/* ~/shared/
# un-comment this to over-write Strelka´s settings with Jared´s ones
#cp hla_pipeline/configureStrelkaSomaticWorkflow.py.ini ~/shared/strelka/bin/
export GATK3_PATH=~/shared/gatk3-8.jar
