# Instructions to install the tools and dependencies using Anaconda

# Install Anaconda if you have not done it already

mkdir -p ~/shared

# Create environment with all the tools
conda env create -f environment.yml

# Download mhcflurry models
mhcflurry-downloads fetch models_class1_presentation

# Download and install VEP cache (Make use to use the same version as the installed VEP)
mkdir -p $HOME/.vep
cd $HOME/.vep
curl -O http://ftp.ensembl.org/pub/release-102/variation/indexed_vep_cache/homo_sapiens_vep_102_GRCh38.tar.gz
tar xzf homo_sapiens_vep_102_GRCh38.tar.gz

curl -O http://ftp.ensembl.org/pub/release-102/variation/indexed_vep_cache/homo_sapiens_vep_102_GRCh37.tar.gz
tar xzf homo_sapiens_vep_102_GRCh37.tar.gz

cd ~/shared

# Install Strelka (Conda version is only compatible with Python 2.7)
wget https://github.com/Illumina/strelka/releases/download/v2.9.10/strelka-2.9.10.centos6_x86_64.tar.bz2
tar -xjf strelka-2.9.10.centos6_x86_64.tar.bz2
mv strelka-2.9.10.centos6_x86_64 ~/shared/strelka

# Install GATK3 from archives
cd ~/shared
gsutil cp gs://gatk-software/package-archive/gatk/GenomeAnalysisTK-3.8-1-0-gf15c1c3ef.tar.bz2 .
tar xjf GenomeAnalysisTK-3.8-1-0-gf15c1c3ef.tar.bz2
mv GenomeAnalysisTK-3.8-1-0-gf15c1c3ef/GenomeAnalysisTK.jar gatk3.8.jar

cd ~

# Clone the pipeline and install it
git clone https://github.com/jfnavarro/hla_pipeline.git
cd hla_pipeline
cp shared/* ~/shared/
python setup.py install
